import*as React from"react";import{ObservableValue}from"../Core/Observable";import{Observer}from"../Observer";import{Portal}from"../Portal";import{css,getPointByEventType,Pointer}from"../Util";import{distance}from"./Position";export var DragDropEffect;!function(e){e.none="none",e.move="move",e.copy="copy"}(DragDropEffect||(DragDropEffect={}));var DragDropManager=function(){function e(){var e=this;this.onEventCaptured=function(t){var r=t.type;if("pointermove"===r){if(e.dragInProgress){if(o=e.getTargetFromEvent(t)){n=getPointByEventType(t);e.operation.x.value=n.x,e.operation.y.value=n.y,dispatchCustomDragEvent("dragover",o,t,e.dataTransfer),t.preventDefault()}}else if(e.potentialDragInProgress){var n=getPointByEventType(t);distance(e.initialCoordinates,n)>e.minimumPixelsForDrag&&(dispatchCustomDragEvent("dragstart",e.dragSourceElement,t,e.dataTransfer),e.dataTransfer.effectAllowed===DragDropEffect.none?(e.potentialDragInProgress=!1,e.endDrag()):e.dragInProgress=!0,t.preventDefault())}}else if("pointerup"===r){if(e.dragInProgress){var o=e.getTargetFromEvent(t);dispatchCustomDragEvent("dragend",e.dragSourceElement,t,e.dataTransfer),o&&e.dataTransfer.dropEffect!==DragDropEffect.none&&dispatchCustomDragEvent("drop",o,t,e.dataTransfer)}e.endDrag()}},this.onPointerLeave=function(t){e.dataTransfer.dropEffect=DragDropEffect.none},this.onPointerOut=function(t){t.target&&(e.dataTransfer.dropEffect=DragDropEffect.none,dispatchCustomDragEvent("dragexit",t.target,t,e.dataTransfer))},this.onPointerOver=function(t){t.target&&(e.dataTransfer.dropEffect=DragDropEffect.none,dispatchCustomDragEvent("dragenter",t.target,t,e.dataTransfer))}}return e.prototype.beginDragOperation=function(e,t,r){return void 0===r&&(r=4),this.operation=void 0,this.dragInProgress||"pointerdown"===e.type&&(this.startDrag(e,r,t),this.initialCoordinates={x:e.clientX,y:e.clientY},Pointer.setCapture(this.onEventCaptured),document.body.addEventListener("pointerout",this.onPointerOut,!0),document.body.addEventListener("pointerover",this.onPointerOver,!0),document.body.addEventListener("pointerleave",this.onPointerLeave),this.operation={x:new ObservableValue(void 0),y:new ObservableValue(void 0)}),this.operation},e.prototype.endDrag=function(){document.body.removeEventListener("pointerout",this.onPointerOut),document.body.removeEventListener("pointerover",this.onPointerOver),document.body.removeEventListener("pointerleave",this.onPointerLeave),this.dragInProgress=!1},e.prototype.getTargetFromEvent=function(e){return e.target},e.prototype.startDrag=function(e,t,r){this.potentialDragInProgress=!0,this.dragSourceElement=e.target,this.minimumPixelsForDrag=t,this.dataTransfer=r},e}(),dragDropManager=new DragDropManager;export function beginDragOperation(e,t,r){return dragDropManager.beginDragOperation(e,t,r)};export function dispatchCustomDragEvent(e,t,r,n){var o=new CustomEvent(e,{bubbles:!0,detail:{dataTransfer:n,nativeEvent:r}});return t.dispatchEvent(o),o};export var DragImage=function(e){var t=e.className,r=e.operation,n=e.xOffset,o=void 0===n?5:n,a=e.yOffset,i=void 0===a?5:a;return React.createElement(Portal,{className:"bolt-drag-image-portal"},React.createElement(Observer,{x:r.x,y:r.y},function(r){return void 0!==r.x&&void 0!==r.y?React.createElement("div",{className:css(t,"bolt-drag-image depth-16 absolute flex-row flex-center scroll-hidden justify-center"),style:{left:r.x+o+"px",top:r.y+i+"px"}},e.children):null}))};