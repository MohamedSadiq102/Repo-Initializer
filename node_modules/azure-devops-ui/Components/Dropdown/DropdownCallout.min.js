import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{format}from"../../Core/Util/String";import{Button}from"../../Button";import{Callout,ContentSize}from"../../Callout";import{FocusZone,FocusZoneDirection,FocusZoneKeyStroke}from"../../FocusZone";import{IconSize}from"../../Icon";import{ListBox}from"../../ListBox";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{TextField}from"../../TextField";import{css,getSafeIdSelector,KeyCode,preventDefault}from"../../Util";var ItemsForFilter=10,DefaultWidth=256,FilterBarPadding=16,FilterBarIconWidth=27;export function DropdownCallout(e){return React.createElement(DropdownCalloutComponent,__assign({},e))};var DropdownCalloutComponent=function(e){function t(t){var o=e.call(this,t)||this;return o.callout=React.createRef(),o.calloutContent=React.createRef(),o.filterBox=React.createRef(),o.initFocusElement=React.createRef(),o.updateLayout=function(){return setTimeout(function(){o.callout.current&&o.callout.current.updateLayout()},0),!0},o.onMouseDown=function(e){o.props.ignoreMouseDown&&"INPUT"!==e.target.tagName&&preventDefault(e)},o.listBoxDidUpdate=function(){o.getScrollWidth()},o.getScrollWidth=function(){window.requestAnimationFrame(function(){if(o.calloutContent.current){var e=o.calloutContent.current.offsetWidth-o.props.width;Math.abs(e)>1&&o.setState({scrollBarWidth:e+o.state.scrollBarWidth})}})},o.state={scrollBarWidth:0},o}return __extends(t,e),t.prototype.componentDidMount=function(){this.getScrollWidth()},t.prototype.focus=function(){this.filterBox.current?this.filterBox.current.focus():this.initFocusElement.current&&this.initFocusElement.current.focus()},t.prototype.render=function(){var e=this,t=this.props,o=t.actions,r=t.anchorElement,n=t.anchorOffset,l=t.anchorOrigin,i=t.anchorPoint,a=t.ariaLabel,s=t.blurDismiss,c=void 0===s||s,u=t.calloutContentClassName,d=t.columns,m=t.containerClassName,f=t.contentLocation,p=t.dropdownOrigin,h=t.enforceSingleSelect,b=t.excludeFocusZone,g=t.excludeTabStop,x=t.filteredItems,v=t.filteredNoResultsText,R=t.filteredResultsLoadingText,w=t.filterPlaceholderText,C=t.filterText,F=t.focusOnMount,D=t.getUnselectableRanges,S=t.id,I=t.items,B=t.lightDismiss,E=t.listBoxClassName,N=t.listBoxRef,T=t.loading,y=t.onActivate,L=t.onFilterKeyDown,O=t.onFilterTextChanged,W=t.onSelect,P=t.onToggle,k=t.renderBeforeContent,Z=t.renderItem,_=t.searching,M=t.selection,z=t.showCloseButton,K=t.showFilterBox,U=t.showItemsWhileSearching,A=t.showTree,V=t.title,q=t.updateFilteredItems,j=t.userFilteredItems,G=this.props.width,H=void 0===G?DefaultWidth:G;H>0&&(H-=this.state.scrollBarWidth);var J="bolt-dropdown-textfield-"+S,Q=function(){C.value="",O&&O(null,""),q&&q()},X=function(){e.props.onDismiss&&e.props.onDismiss(),Q()};return React.createElement(Callout,{anchorElement:r,anchorOffset:n,anchorOrigin:l,anchorPoint:i,role:"presentation",blurDismiss:c,calloutOrigin:p,contentClassName:css(u,"bolt-dropdown flex-column custom-scrollbar v-scroll-auto h-scroll-hidden"),contentLocation:f,contentRef:this.calloutContent,contentShadow:!0,contentSize:ContentSize.Auto,escDismiss:!0,id:S,lightDismiss:B,focuszoneProps:{postprocessKeyStroke:function(e){return e.which!==KeyCode.tab||e.defaultPrevented?FocusZoneKeyStroke.IgnoreNone:(e.preventDefault(),X(),FocusZoneKeyStroke.IgnoreAll)}},onDismiss:X,ref:this.callout},React.createElement(FocusZone,{circularNavigation:!0,defaultActiveElement:K||void 0===K&&I.length>ItemsForFilter?getSafeIdSelector(J):".bolt-dropdown-init-focus",direction:FocusZoneDirection.Vertical,focusOnMount:void 0===F||F},React.createElement("div",{className:"bolt-dropdown-container no-outline",onMouseDown:this.onMouseDown,onKeyDown:L,style:{width:H>=0?H:void 0}},React.createElement("div",{"aria-hidden":"true","aria-roledescription":Resources.DropdownCalloutRoleDescription,className:"bolt-dropdown-init-focus no-outline",tabIndex:g?void 0:-1,ref:this.initFocusElement,role:"menuitem"}),React.createElement(Observer,{items:{observableValue:I,filter:this.updateLayout}},function(){var t=void 0===K?I.length>ItemsForFilter:K;return t||V||z?React.createElement("div",{className:"bolt-dropdown-header-container"},(V||z)&&React.createElement("div",{className:"bolt-dropdown-header flex-row flex-center"},React.createElement("div",{className:"bolt-dropdown-header-text flex-grow font-weight-semibold"},V),z&&React.createElement(Button,{className:"bolt-dropdown-header-button",ariaLabel:Resources.Close,iconProps:{iconName:"Cancel"},onClick:X,subtle:!0})),t&&React.createElement("div",{key:"bolt-dropdown-filter-container",className:"bolt-dropdown-filter-container"},React.createElement(Observer,{filterText:C},function(t){return React.createElement(TextField,{key:"bolt-dropdown-filter",ariaLabel:Resources.SearchAriaLabel,className:"bolt-dropdown-filter",excludeTabStop:!0,inputId:J,onChange:O,placeholder:w,prefixIconProps:{iconName:"Search"},ref:e.filterBox,value:C,maxWidth:e.props.width-FilterBarPadding-FilterBarIconWidth,suffixIconProps:t.filterText.length>0?{ariaLabel:Resources.ClearText,iconName:"ChromeClose",onClick:Q,size:IconSize.small,tooltipProps:{text:Resources.ClearText}}:void 0})}))):null}),k&&k(),React.createElement(Observer,{filteredItems:x,filteredNoResultsText:v,listBoxItems:{observableValue:I,filter:q},userFilteredItems:{observableValue:j,filter:q}},function(t){var o=null,r="";return(x&&0===x.length||0===I.length)&&!_&&(r=""===C.value?e.props.noItemsText:format(t.filteredNoResultsText||Resources.NoFilterResults,C.value))&&(o=React.createElement("div",{className:"bolt-dropdown-no-items"},r)),React.createElement(React.Fragment,null,o,React.createElement(ListBox,{ariaLabel:a,className:E,columns:d,containerClassName:css("bolt-dropdown-list-box-container",m),didUpdate:e.listBoxDidUpdate,enforceSingleSelect:h,excludeFocusZone:b,excludeTabStop:!0,searchResultsLoadingText:R,focuszoneProps:null,getUnselectableRanges:D,items:x?x.value:I,loading:T,onActivate:y,onSelect:W,onToggle:P,renderItem:Z,ref:N,searching:_,selection:M,showChecksColumn:!0,showItemsWhileSearching:U,showTree:A}))}),React.createElement(Observer,{actions:o},function(t){var o=e.props.actions;return o&&o.length?React.createElement("div",{className:"bolt-actions-container flex-column"},ObservableLike.getValue(o).map(function(e,t){return React.createElement(Button,__assign({key:e.id||t,subtle:!0,excludeTabStop:!0},e))})):null}))))},t.defaultProps={width:DefaultWidth,ignoreMouseDown:!0},t}(React.Component);export{DropdownCalloutComponent};