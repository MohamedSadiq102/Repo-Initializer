function updateFilteredItems(e,t){var r=t.filteredSelection,n=t.filterText,i=[],l=getListBoxItemsValue(t.wrappedItems||e.items),o=l;if(e.userFilteredItems){o=getItemsValue(e.userFilteredItems);var s=e.userFilteredItemsIndexMap&&e.userFilteredItemsIndexMap.value;if(s)i=s;else for(var a=function(e){var t=l.findIndex(function(t){return t.id===o[e].id});i.push(t)},d=0;d<e.userFilteredItems.length;d++)a(d)}if(e.filterByText&&n.value){var p=filterItems(o,n.value,i,e.filterItem);o=p.filteredItems,i=p.filteredIndexMap}for(;o.length&&o[0].type===ListBoxItemType.Divider;)o.shift(),i.shift();if(!ObservableLike.getValue(e.searching)&&!ObservableLike.getValue(e.loading)&&t.expanded.value)if(n.value){var c=Resources.NoFilterResults;e.filteredNoResultsText&&(c=ObservableLike.getValue(e.filteredNoResultsText)),Utils_Accessibility.announce(o.length>0?format(Resources.AnnounceFilterResultCount,o.length):c,!0)}else 0===o.length&&e.noItemsText?Utils_Accessibility.announce(e.noItemsText,!0):o.length>0&&Utils_Accessibility.announce(format(Resources.AnnounceItemCount,o.length));return r.updateFilteredSelection(i,!e.enforceSingleSelect&&void 0),t.filteredItems.value=o,!0}import{__assign,__extends,__spreadArrays}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableArray,ObservableLike,ObservableValue}from"../../Core/Observable";import{TimerManagement}from"../../Core/TimerManagement";import*as Utils_Accessibility from"../../Core/Util/Accessibility";import{format}from"../../Core/Util/String";import{FilteredListSelection,renderListCell}from"../../List";import{getListBoxItemsValue,getUnselectableRanges,ListBoxItemType,wrapListBoxItems}from"../../ListBox";import{ItemsObserver,Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{SimpleTableCell}from"../../Table";import{css}from"../../Util";import{DropdownSelection}from"../../Utilities/DropdownSelection";import{getItemsValue}from"../../Utilities/Provider";import{DropdownCallout}from"./DropdownCallout";import{DropdownExpandableTextField}from"./DropdownExpandableTextField";var Dropdown=function(e){function t(t){var r=e.call(this,t)||this;r.expandable=React.createRef(),r.expandableContainer=React.createRef(),r.filterText=new ObservableValue(""),r.collapse=function(){r.expandable.current&&r.expandable.current.collapse()},r.expand=function(){r.expandable.current&&r.expandable.current.expand()},r.onDismiss=function(){r.expandable.current&&r.expandable.current.collapse()},r.onExpand=function(){r.props.onExpand&&r.props.onExpand(),r.updateFilteredItems(),r.state.expanded.value=!0},r.onCollapse=function(){r.props.onCollapse&&r.props.onCollapse(),r.state.expanded.value=!1},r.onActivate=function(e,t){if(!e.defaultPrevented&&"keydown"===e.type){var n=!r.props.enforceSingleSelect&&r.state.filteredSelection.multiSelect;n?r.state.filteredSelection.toggle(r.state.filteredItems.value.indexOf(t),r.state.filteredSelection.alwaysMerge,n):r.state.filteredSelection.select(r.state.filteredItems.value.indexOf(t),1,r.state.filteredSelection.alwaysMerge,n),r.onSelect(e,t)}},r.onFilterTextChanged=function(e,t){r.filterText.value=t,r.debouncedUpdateFilteredItems()},r.onSelect=function(e,t){var n=r.props,i=n.dismissOnSelect,l=n.onSelect,o=r.parentSelection;l&&l(e,t),(void 0!==i?i:o.value.length>0&&!(!r.props.enforceSingleSelect&&o.multiSelect)&&!o.selectOnFocus)&&r.onDismiss()},r.selectionChanged=function(e,t){return r.state.filteredSelection.selectionChanged(e,t),!0},r.renderCallout=function(e,t,n,i,l,o,s){var a,d=r.props,p=d.actions,c=d.calloutContentClassName,m=d.columns,u=d.containerClassName,f=d.filterPlaceholderText,x=d.filteredNoResultsText,h=d.getUnselectableRanges,g=d.items,I=d.loading,b=d.noItemsText,v=d.onToggle,T=d.renderItem,y=d.renderBeforeContent,S=d.searching,C=d.showFilterBox,w=d.showItemsWhileSearching,L=d.showTree,F=d.userFilteredItems,R=r.props.width;if(void 0===R&&r.expandableContainer.current){var B=null!==(a=r.props.minCalloutWidth)&&void 0!==a?a:100;R=Math.max(r.expandableContainer.current.clientWidth,B)}var O=r.state,D=O.filteredItems,_=O.filterText,A={actions:p,anchorElement:n,anchorOffset:i,anchorOrigin:l,anchorPoint:o,calloutContentClassName:c,columns:m,containerClassName:u,dropdownOrigin:s,filteredItems:D,filteredNoResultsText:x,selection:O.filteredSelection,filterPlaceholderText:f,filterText:_,getUnselectableRanges:h,id:t,items:g,loading:I,noItemsText:b,onActivate:r.onActivate,onFilterTextChanged:r.onFilterTextChanged,onDismiss:r.onDismiss,onSelect:r.onSelect,onToggle:v,renderBeforeContent:y,renderItem:T,searching:S,showItemsWhileSearching:w,showFilterBox:C,showTree:L,updateFilteredItems:r.updateFilteredItems,userFilteredItems:F,width:R};return r.props.renderCallout(A)},r.updateFilteredItems=function(){return updateFilteredItems(r.props,r.state),!0},r.debouncedUpdateFilteredItems=function(){updateFilteredItems(r.props,r.state)},r.parentSelection=t.selection||new DropdownSelection;var n=wrapListBoxItems(t.items),i=getListBoxItemsValue(n||t.items);return r.timerManagement=new TimerManagement,r.state={expanded:new ObservableValue(!1),filteredItems:new ObservableArray(__spreadArrays(i)),filteredSelection:new FilteredListSelection(r.parentSelection),filterText:r.filterText,props:t,wrappedItems:n},r}return __extends(t,e),t.getDerivedStateFromProps=function(e,t){return e.userFilteredItems===t.props.userFilteredItems&&e.items===t.props.items||updateFilteredItems(e,t),__assign(__assign({},t),{props:e,wrappedItems:wrapListBoxItems(e.items)})},t.prototype.componentDidMount=function(){this.props.filterThrottleWait&&(this.debouncedUpdateFilteredItems=this.timerManagement.debounce(this.debouncedUpdateFilteredItems,this.props.filterThrottleWait))},t.prototype.render=function(){var e=this,t=this.props,r=t.ariaLabel,n=t.className,i=t.disabled,l=t.enforceSingleSelect,o=t.excludeTabStop,s=t.items,a=t.placeholder,d=t.renderExpandable,p=t.renderSelectedItems,c=t.showPrefix,m={observableValue:this.parentSelection,filter:this.selectionChanged};return React.createElement(ItemsObserver,{getUnselectableRanges:this.props.getUnselectableRanges,items:s,selection:this.parentSelection},React.createElement(Observer,{selection:m},function(){return d({ariaLabel:r,className:css(n,"bolt-dropdown-expandable"),containerRef:e.expandableContainer,disabled:i,enforceSingleSelect:l,excludeTabStop:o,placeholder:a,onCollapse:e.onCollapse,onExpand:e.onExpand,expandableRef:e.expandable,renderCallout:e.renderCallout,items:getListBoxItemsValue(e.state.wrappedItems||s),renderSelectedItems:p,selection:e.parentSelection,showPrefix:c})}))},t.prototype.focus=function(){this.expandable.current&&this.expandable.current.focus()},t.defaultProps={filterByText:!0,filterItem:filterItemByText,getUnselectableRanges:getUnselectableRanges,renderCallout:DropdownCallout,renderExpandable:DropdownExpandableTextField,renderSelectedItems:renderDropdownSelectedItemText},t}(React.Component);export{Dropdown};export function filterItemByText(e,t){return!(!t.text||t.type===ListBoxItemType.Header||t.type===ListBoxItemType.Divider||t.type===ListBoxItemType.Loading)&&-1!==t.text.toLowerCase().indexOf(e.toLowerCase())};export function renderDropdownSelectedItemText(e,t){var r=t[e.value[0].beginIndex],n=r&&r.text||"";return e.selectedCount>1&&(n=n+" (+"+(e.selectedCount-1)+")"),n};export function filterItems(e,t,r,n){void 0===r&&(r=[]),void 0===n&&(n=filterItemByText);var i=[],l=[],o=[];if(t)for(var s=void 0,a=-1,d=void 0,p=-1,c=0,m=e.length;c<m;c++){var u=e[c],f=r.length?r[c]:c;if(u.type===ListBoxItemType.Header)s=u,a=f;else if(u.type===ListBoxItemType.Divider)d=u,p=f;else{var x=n(t,u,e);(x||u.type===ListBoxItemType.Loading)&&(d&&d.groupId===u.groupId&&(i.push(d),l.push(p),d=void 0),s&&s.groupId===u.groupId&&(i.push(s),l.push(a),s=void 0),i.push(u),l.push(f),o.push(Array.isArray(x)?x:[]))}}return{filteredItems:i,filteredIndexMap:l,filterMatches:o}};export function filterTreeItems(e,t,r,n,i){void 0===r&&(r=[]),void 0===n&&(n=filterItemByText),void 0===i&&(i=filterMatchedItemByListboxType);for(var l=filterItems(e,t,r,n),o=l.filteredIndexMap,s=l.filteredItems.find(i),a={},d=0,p=o;d<p.length;d++){for(var c=e[I=p[d]],m=c.parent;m;){a[e.indexOf(m)]=m,m.expanded=!0,m=m.parent}a[I]=c}for(var u=[],f=[],x=0,h=Object.keys(a);x<h.length;x++){var g=h[x],I=Number(g),b=a[I];u.push(I),f.push(b)}return[{filteredIndexMap:u,filteredItems:f,filterMatches:[]},s?e.indexOf(s):-1]};export function filterMatchedItemByListboxType(e){return!e.type||e.type===ListBoxItemType.Row};export function renderHighlightedText(e,t,r,n,i){var l=n;return i&&n.text&&(l=__assign(__assign({},n),{textNode:getHighlightedText(n.text,i)})),React.createElement(SimpleTableCell,{className:css(r.className,n.className,n.type===ListBoxItemType.Header&&"bolt-list-box-header"),columnIndex:t,key:t,tableColumn:r},React.createElement("div",{id:n.type===ListBoxItemType.Header?"header-"+n.id:void 0,"aria-label":n.type===ListBoxItemType.Header?format(Resources.HeaderAriaLabel,n.text):void 0},renderListCell(l)))};export function getHighlightedText(e,t,r){for(var n=[],i=-1,l=0;l<e.length;l++)-1!==t.indexOf(l)?n&&n[n.length-1]&&n[n.length-1].bold?n[i].text+=e.charAt(l):n[++i]={text:e.charAt(l),bold:!0}:n&&n[n.length-1]&&!n[n.length-1].bold?n[i].text+=e.charAt(l):n[++i]={text:e.charAt(l),bold:!1};for(var o=[],l=0;l<n.length;l++){var s=n[l];s.bold?o.push(React.createElement("span",{className:"font-weight-heavy",key:e+"-"+l},s.text)):o.push(s.text)}return React.createElement("span",{className:r},o)};