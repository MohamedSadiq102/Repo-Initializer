function eventIsOnHeader(t){var e=cellFromEvent(t);return-1===e.rowIndex?e.cellIndex:null}import"../../CommonImports";import"../../Core/core.css";import"./Table.css";import*as React from"react";import{ListDropIndicatorPosition}from"../../Components/List/ListDropIndicator.Props";import{cellFromEvent}from"../../List";import{getPointByEventType}from"../../Util";import{beginDragOperation,DragDropEffect,DragImage}from"../../Utilities/DragDrop";import{ListDropIndicator}from"../List/ListDropIndicator";import{ColumnFillId}from"./Table";var ColumnDragDropBehavior=function(){function t(t){var e=this;this.initialize=function(t,n,r){e.dragDroppableUI=n,e.eventDispatch=r,e.eventDispatch.addEventListener("pointerdown",e.onPointerDown),e.eventDispatch.addEventListener("dragstart",e.onDragStart),e.eventDispatch.addEventListener("dragend",e.onDragEnd),e.eventDispatch.addEventListener("dragenter",e.onDragEnter),e.eventDispatch.addEventListener("dragexit",e.onDragExit),e.eventDispatch.addEventListener("dragover",e.onDragOver),e.eventDispatch.addEventListener("drop",e.onDrop),e.indicatorName="drop-indicator"},this.onDragEnd=function(t){var n=eventIsOnHeader(t);n&&n>=0&&e.options.onDragEnd&&e.options.onDragEnd(t),e.dragDroppableUI.removeOverlay("drag-source-item"),e.dragImageData=void 0},this.onDragStart=function(t){if(t.detail.dataTransfer){var n=eventIsOnHeader(t);n&&n>=0&&(e.options.onDragStart&&e.options.onDragStart(t),t.detail.dataTransfer.effectAllowed!==DragDropEffect.none&&(e.dragDroppableUI.addOverlay("drag-source-item",-1,e.renderDragSourceItemOverlay,0,n),void 0===e.dragImageData&&(e.dragImageData={image:e.options.renderDragImage(t)})))}},this.onPointerDown=function(t){0===t.button&&e.beginDrag(t)},this.renderDragSourceItemOverlay=function(t){return React.createElement(React.Fragment,null,React.createElement("div",{className:"bolt-list-drag-source-item flex-grow"}),e.operation&&e.dragImageData&&React.createElement(DragImage,{operation:e.operation},e.dragImageData.image))},this.setDragImage=function(t,n,r){e.dragImageData={image:t,xOffset:n,yOffset:r}},this.onDragEnter=function(t){e.handlesType(t)&&(e.options.onDragEnter?e.options.onDragEnter(t):t.detail.dataTransfer.dropEffect=DragDropEffect.move)},this.onDragExit=function(t){e.handlesType(t)&&(e.options.onDragExit&&e.options.onDragExit(t),e.dragDroppableUI.removeOverlay(e.indicatorName))},this.onDragOver=function(t){if(e.handlesType(t)){var n=e.calculateIndex(t),r=t.detail.dataTransfer.secondaryData.index,o=t.detail.dataTransfer.secondaryData.sourceId;n>=0&&(n!==r||o!==e.options.id)&&e.options.columns[n].id!==ColumnFillId?e.options.onDragOver?e.options.onDragOver(t,{index:e.listIndicatorPosition===ListDropIndicatorPosition.right?n+1:n}):t.detail.dataTransfer.dropEffect=DragDropEffect.move:t.detail.dataTransfer.dropEffect=DragDropEffect.none,t.detail.dataTransfer.dropEffect===DragDropEffect.none?e.dragDroppableUI.removeOverlay(e.indicatorName):e.dragDroppableUI.addOverlay(e.indicatorName,-1,e.renderDropIndicator,0,n)}},this.onDrop=function(t){if(e.handlesType(t)){var n=e.calculateIndex(t),r=t.detail.dataTransfer.secondaryData.index,o=t.detail.dataTransfer.secondaryData.sourceId;n>=0&&(n!==r||o!==e.options.id)&&e.options.onDrop&&(t.persist(),e.options.onDrop(t,{index:e.listIndicatorPosition===ListDropIndicatorPosition.right?n+1:n})),e.dragDroppableUI.removeOverlay(e.indicatorName)}},this.renderDropIndicator=function(t){var n=e.listIndicatorPosition===ListDropIndicatorPosition.right?t.rowElement.offsetWidth:0;return React.createElement(ListDropIndicator,{position:e.listIndicatorPosition,xOffset:n-3,lineOffset:n})},this.options=t,this.contextMenuIndex=t.columns.findIndex(function(t){return"_more"===t.id})}return t.prototype.componentWillUnmount=function(){var t,e,n,r,o,a,i;null===(t=this.eventDispatch)||void 0===t||t.removeEventListener("pointerdown",this.onPointerDown),null===(e=this.eventDispatch)||void 0===e||e.removeEventListener("dragstart",this.onDragStart),null===(n=this.eventDispatch)||void 0===n||n.removeEventListener("dragend",this.onDragEnd),null===(r=this.eventDispatch)||void 0===r||r.removeEventListener("dragenter",this.onDragEnter),null===(o=this.eventDispatch)||void 0===o||o.removeEventListener("dragexit",this.onDragExit),null===(a=this.eventDispatch)||void 0===a||a.removeEventListener("dragover",this.onDragOver),null===(i=this.eventDispatch)||void 0===i||i.removeEventListener("drop",this.onDrop)},t.prototype.beginDrag=function(t){var e,n=eventIsOnHeader(t);if(n&&(null===(e=this.options)||void 0===e?void 0:e.columns)&&n>=0){var r=this.options.columns[n];this.operation=beginDragOperation(t,{data:r,dropEffect:DragDropEffect.none,secondaryData:{index:n,sourceId:this.options.id},setDragImage:this.setDragImage,type:this.options.type})}},t.prototype.handlesType=function(t){var e,n=(null===(e=t.detail.dataTransfer)||void 0===e?void 0:e.type)||"";return-1!==this.options.allowedTypes.indexOf(n)},t.prototype.calculateIndex=function(t){var e=cellFromEvent(t),n=e.cellIndex;if(e.cellElement&&t.detail.dataTransfer.secondaryData){var r=t.detail.dataTransfer.secondaryData.index,o=t.detail.nativeEvent,a=e.cellElement.getBoundingClientRect(),i=getPointByEventType(o),s=i?i.x<a.width/2+a.left:n<r;n<r?(this.listIndicatorPosition=ListDropIndicatorPosition.left,s||n++,n===this.contextMenuIndex&&n--):n>r&&(this.listIndicatorPosition=ListDropIndicatorPosition.right,s&&n--,n+1<this.options.columns.length&&n+1==this.contextMenuIndex&&n++)}return n},t}();export{ColumnDragDropBehavior};