import{__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Sizer.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{TimerManagement}from"../../Core/TimerManagement";import{Observer}from"../../Observer";import{Portal}from"../../Portal";import{css,KeyCode,Mouse}from"../../Util";import{Orientation,Position}from"./Sizer.Props";import{announce}from"../../Core/Util/Accessibility";import*as Resources from"../../Resources.Widgets";import{format}from"../../Core/Util/String";var Sizer=function(e){function o(o){var t=e.call(this,o)||this;return t.lastLocation=-1,t.timerManagement=new TimerManagement,t.state={showPortal:!1},t.onMouseCapture=function(e){t.lastLocation+=t.updateSize(e,t.getMouseLocation(e)-t.lastLocation),"mouseup"===e.type&&(t.setState({showPortal:!1}),t.onSizeEnd())},t.onKeyDown=function(e){var o;if(!e.defaultPrevented){var i=void 0;if(t.props.orientation===Orientation.row){if(e.which===KeyCode.enter){var r=t.props.getFocusedElement(e);null===(o=null===r||void 0===r?void 0:r.current)||void 0===o||o.focus()}e.which===KeyCode.leftArrow?i=t.updateSize(e.nativeEvent,-1):e.which===KeyCode.rightArrow&&(i=t.updateSize(e.nativeEvent,1))}else e.which===KeyCode.upArrow?i=t.updateSize(e.nativeEvent,-1):e.which===KeyCode.downArrow&&(i=t.updateSize(e.nativeEvent,1));i&&(e.preventDefault(),t.debouncedEnd())}},t.onSizeEnd=function(){t.props.onSizeEnd&&t.props.onSizeEnd(t.props.id)},t.onMouseDown=function(e){e.defaultPrevented||(t.lastLocation=t.getMouseLocation(e.nativeEvent),Mouse.setCapture(t.onMouseCapture),t.setState({showPortal:!0}),e.preventDefault())},t.onFocus=function(e){announce(format(Resources.SizerLabel,t.props.size,t.props.minSize,t.props.maxSize),!0)},t.debouncedEnd=t.timerManagement.debounce(t.onSizeEnd,500,{trailing:!0}),t}return __extends(o,e),o.prototype.render=function(){var e=this.props.divider;return React.createElement("div",{"aria-label":this.props.ariaLabel,"aria-valuemin":this.props.minSize,"aria-valuemax":this.props.maxSize,"aria-valuenow":ObservableLike.getValue(this.props.size),className:css(this.props.className,"bolt-sizer",this.props.orientation===Orientation.row?"bolt-sizer-row flex-row":"bolt-sizer-column flex-column",e&&"divider"),id:this.props.id,onKeyDown:this.onKeyDown,onMouseDown:this.onMouseDown,role:"separator",tabIndex:this.props.tabIndex,onFocus:this.onFocus},this.state.showPortal&&React.createElement(Portal,{className:css("bolt-sizer-portal",this.props.orientation===Orientation.row?"bolt-sizer-portal-row":"bolt-sizer-portal-column")},React.createElement("div",null)))},o.prototype.componentWillUnmount=function(){Mouse.releaseCapture(this.onMouseCapture),this.timerManagement.dispose()},o.prototype.getMouseLocation=function(e){return this.props.orientation===Orientation.row?e.pageX:e.pageY},o.prototype.updateSize=function(e,o){var t=ObservableLike.getValue(this.props.size),i=this.props.position===Position.far?-1:1,r=Math.floor(Math.min(this.props.maxSize,Math.max(this.props.minSize,t+o*i)));return this.props.onSize(e,r,this.props.id),announce(format(Resources.SizerValueChanged,r),!0),(r-t)*i},o.defaultProps={divider:!0,maxSize:1e4,minSize:100},o}(React.Component);export{Sizer};export function Sized(e){return React.createElement(Observer,{height:e.height,width:e.width},function(o){var t={};return void 0!==o.height&&(t.height=o.height+"px"),void 0!==o.width&&(t.width=o.width+"px"),React.createElement("div",{className:css(e.className,"flex-noshrink"),style:t},e.children)})};