function getObservableValue(e){return e&&void 0!==e.observableValue?e.observableValue:e}function getPropValue(e){return ObservableLike.getValue(getObservableValue(e))}function updateSubscriptionsAndState(e,t,r,s){var i=__assign({},r),n=!1;if(e)for(var o in e){(a=getObservableValue(e[o]))!==(u=getObservableValue(t[o]))&&(s&&s.unsubscribe(o,e),void 0===u&&(delete i.values[o],n=!0))}for(var o in t){var a=e&&getObservableValue(e[o]),u=getObservableValue(t[o]);a!==u&&(s&&s.subscribe(o,t),r.values[o]!==getPropValue(u)&&(i.values[o]=getPropValue(u),n=!0))}return n?i:null}import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";var ObserverBase=function(e){function t(t){var r=e.call(this,t)||this;r.subscriptions={};var s={values:{},oldProps:{}};for(var i in t)s.values[i]=getPropValue(t[i]);return r.state=s,r}return __extends(t,e),t.getDerivedStateFromProps=function(e,t){var r=updateSubscriptionsAndState(t.oldProps,e,t);return null!=r?__assign(__assign({},r),{oldProps:e}):{oldProps:e}},t.prototype.render=function(){var e={};for(var t in this.state.values)"children"!==t&&(e[t]=this.state.values[t]);if("function"==typeof this.props.children){return(r=this.props.children)(e)}var r=React.Children.only(this.props.children);return React.cloneElement(r,__assign(__assign({},r.props),e),r.props.children)},t.prototype.componentDidMount=function(){this.updateSubscriptionsAndStateAfterRender()},t.prototype.componentDidUpdate=function(){this.updateSubscriptionsAndStateAfterRender(),this.props.onUpdate&&this.props.onUpdate()},t.prototype.componentWillUnmount=function(){for(var e in this.subscribedProps)this.unsubscribe(e,this.subscribedProps)},t.prototype.subscribe=function(e,t){if("children"!==e){var r=void 0,s=t[e],i=void 0;if(s&&void 0!==s.observableValue&&(s=(r=s).observableValue,i=r.action),ObservableLike.isObservable(s)){var n=this.onValueChanged.bind(this,e,s,r);ObservableLike.subscribe(s,n,i),this.subscriptions[e]={delegate:n,action:i}}}},t.prototype.unsubscribe=function(e,t){if("children"!==e){var r=getObservableValue(t[e]);if(ObservableLike.isObservable(r)){var s=this.subscriptions[e];ObservableLike.unsubscribe(r,s.delegate,s.action),delete this.subscriptions[e]}}},t.prototype.updateSubscriptionsAndStateAfterRender=function(){var e=updateSubscriptionsAndState(this.subscribedProps,this.props,this.state,this);null!=e&&this.setState(e),this.subscribedProps=__assign({},this.props)},t.prototype.onValueChanged=function(e,t,r,s,i){var n=!0;e in this.subscriptions&&(r&&r.filter&&(n=r.filter(s,i)),n&&this.setState(function(r,i){var n;return{values:__assign(__assign({},r.values),(n={},n[e]=t.value||s,n))}}))},t}(React.Component),Observer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(ObserverBase);export{Observer};var UncheckedObserver=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(ObserverBase);export{UncheckedObserver};